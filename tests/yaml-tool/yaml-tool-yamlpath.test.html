<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YAML Path Tests for YAML Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        .results .pass { color: green; }
        .results .fail { color: red; }
    </style>
</head>
<body>
    <h1>YAML Path Tests for YAML Tool</h1>
    <div class="results"></div>

    <script>
        // Mock dependencies for YamlTool
        window.createHistoryManager = () => ({ addHistoryEntry: () => {} });
        window.createSourceSelector = async () => ({ show: () => {} });
        window.validationUtils = { populateValidatorSelect: () => {}, clearValidationStatus: () => {} };

        // Mock DOM elements that are used in the constructor
        document.body.innerHTML += `
            <div id="yamlInput"></div>
            <div id="yamlOutput"></div>
            <div id="yamlOutputFormatted"></div>
            <button id="formatBtn"></button>
            <button id="minifyBtn"></button>
            <button id="stringifyBtn"></button>
            <button id="clearBtn"></button>
            <button id="copyBtn"></button>
            <button id="copyFormattedBtn"></button>
            <button id="loadFromSourceBtn"></button>
            <input id="fileInput">
            <button id="uploadFileBtn"></button>
            <span id="filePathLabel"></span>
            <button id="expandAllBtn"></button>
            <button id="collapseAllBtn"></button>
            <button id="toggleMarkupBtn"></button>
            <select id="indentType"></select>
            <select id="indentSize"></select>
            <button id="fontIncreaseBtn"></button>
            <button id="fontDecreaseBtn"></button>
            <input id="yamlPathInput">
            <button id="clearSearchBtn"></button>
            <div id="validationControls"></div>
            <div id="validationStatus"></div>
            <select id="validatorSelect"></select>
            <button id="validateBtn"></button>
            <div id="statusMessages"></div>
            <div id="yamlStatus"></div>
            <div id="yamlSize"></div>
            <div id="yamlLines"></div>
            <div id="yamlObjects"></div>
            <div id="yamlArrays"></div>
            <div id="yamlProperties"></div>
        `;
    </script>
    <script src="../../frontend/static/js/yaml-tool.js"></script>
    <script>
        const resultsDiv = document.querySelector('.results');
        let testsRun = 0;
        let testsFailed = 0;

        function test(name, fn) {
            testsRun++;
            try {
                fn();
                resultsDiv.innerHTML += `<div class="pass">✅ ${name}</div>`;
            } catch (e) {
                testsFailed++;
                resultsDiv.innerHTML += `<div class="fail">❌ ${name}</div>`;
                console.error(e);
            }
        }

        function assertEquals(actual, expected, message) {
            if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                throw new Error(message || `Expected ${JSON.stringify(expected)}, but got ${JSON.stringify(actual)}`);
            }
        }

        const formatter = new YamlTool();
        const data = {
            "store": {
                "books": [
                    {
                        "category": "reference",
                        "author": "Nigel Rees",
                        "title": "Sayings of the Century",
                        "price": 8.95
                    },
                    {
                        "category": "fiction",
                        "author": "Evelyn Waugh",
                        "title": "Sword of Honour",
                        "price": 12.99
                    },
                    {
                        "category": "fiction",
                        "author": "Herman Melville",
                        "title": "Moby Dick",
                        "isbn": "0-553-21311-3",
                        "price": 8.99
                    }
                ],
                "bicycle": {
                    "color": "red",
                    "price": 19.95
                }
            },
            "expensive": 10
        };

        test('YAML Path - Get store object', () => {
            const result = formatter.evaluateYamlPath(data, 'store');
            assertEquals(result, data.store);
        });

        test('YAML Path - Get first book', () => {
            const result = formatter.evaluateYamlPath(data, 'store.books.0');
            assertEquals(result, data.store.books[0]);
        });

        test('YAML Path - Get book title', () => {
            const result = formatter.evaluateYamlPath(data, 'store.books.0.title');
            assertEquals(result, "Sayings of the Century");
        });

        test('YAML Path - Get bicycle color', () => {
            const result = formatter.evaluateYamlPath(data, 'store.bicycle.color');
            assertEquals(result, "red");
        });

        test('YAML Path - Get expensive value', () => {
            const result = formatter.evaluateYamlPath(data, 'expensive');
            assertEquals(result, 10);
        });

        test('YAML Path - Non-existent path returns undefined', () => {
            const result = formatter.evaluateYamlPath(data, 'store.nonexistent');
            assertEquals(result, undefined);
        });

        test('YAML Path - Deep non-existent path returns undefined', () => {
            const result = formatter.evaluateYamlPath(data, 'store.books.0.nonexistent.deep');
            assertEquals(result, undefined);
        });

        test('YAML Path - Array index out of bounds', () => {
            const result = formatter.evaluateYamlPath(data, 'store.books.99');
            assertEquals(result, undefined);
        });

        test('YAML Structure Analysis', () => {
            const stats = formatter.analyzeYamlStructure(data);

            // Should count objects (store, each book, bicycle)
            if (stats.objects < 4) {
                throw new Error(`Expected at least 4 objects, got ${stats.objects}`);
            }

            // Should count arrays (books array)
            if (stats.arrays < 1) {
                throw new Error(`Expected at least 1 array, got ${stats.arrays}`);
            }

            // Should count properties
            if (stats.properties < 10) {
                throw new Error(`Expected at least 10 properties, got ${stats.properties}`);
            }
        });

        resultsDiv.innerHTML += `<div>---</div><div>${testsRun} tests run, ${testsFailed} failed.</div>`;
    </script>
</body>
</html>